name: celluloid-snap
base: core22
version: 'v0.25'
summary: Simple GTK+ Frontend to MPV.
description: |
  Celluloid (formerly GNOME MPV) is a simple GTK+ frontend for mpv. It aims to be easy to use while maintaining high level of configurability. 
grade: stable
confinement: strict
compression: lzo

architectures:
  - build-on: amd64
    build-for: amd64
    
    
slots:
  celluloid-snap:
    interface: dbus
    bus: session
    name: io.github.celluloid_player.Celluloid
    
  #mpris:
    #interface: mpris
    #name: org.mpris.MediaPlayer2.io.github.celluloid_player.Celluloid   

apps:
  celluloid-snap:
    command: usr/bin/celluloid
    environment:
      LD_LIBRARY_PATH: $SNAP/usr/lib/x86_64-linux-gnu/blas:$SNAP/usr/lib/x86_64-linux-gnu/lapack:$SNAP/usr/lib/x86_64-linux-gnu
    extensions: [gnome]
    common-id: org.community.celluloid
    plugs:
      - home
      - audio-playback
      - alsa
      - pulseaudio
      - bluez
      - bluetooth-control
      - media-control
      - network
      - network-bind
      - raw-usb
      - process-control
      - hostname-control
      - optical-drive
      - network-status
      - removable-media
      - unity7
      - screen-inhibit-control
    #slots:
      #- mpris
      
      
 
 
      
parts:
  celluloid-snap:
    source: https://github.com/celluloid-player/celluloid.git
    plugin: meson
    meson-parameters:
      - --prefix=/usr
    build-packages:
      - curl
      - build-essential
      - libmpv-dev
      - appstream-util
      - autoconf-archive
      - libepoxy-dev
      - libgtk-4-dev
      - pkg-config
      - python3
      - luajit
      
      
    override-pull: |
      craftctl default
      curl -LO https://github.com/celluloid-player/celluloid/releases/download/v0.25/celluloid-0.25.tar.xz
  #craftctl set version=$(git describe --tags --abbrev=0)
    stage-packages:  
      - libgtk-4-1
      - libgtk-4-common
      - libglib2.0-0
      - libmpv1
      - libcairo2
      - libpangocairo-1.0-0
      - libpango-1.0-0
      - libepoxy0
      - gsettings-backend
      - youtube-dl
      - ffmpeg
      - libv4l-0
      - libv4l2rds0
      - libv4lconvert0
      - libass9
      - uchardet
      - libuchardet0
      - libffmpeg-nvenc-dev
      
  libraries:
    plugin: nil
    stage-packages:
      - libblas-dev
      - libblas3
      - liblapack3
    prime:
      - usr/lib/*/libblas3* 
      - usr/lib/*/libblas-dev*
      - usr/lib/*/liblapack3*
     
    
  
  
